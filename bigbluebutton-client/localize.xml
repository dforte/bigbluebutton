<?xml version="1.0" encoding="utf-8"?>
<!-- BigBlueButton Client build.xml for use by Hudson builds.   -->
<project name="BigBlueButton Client" basedir="." default="cleanandmake" >
    	<property environment="env" />
    	<property name="BUILD_ENV" value="DEV" />
    	<property name="FLEX_HOME" value="${env.FLEX_HOME}" />
    	<property name="LOCALE_DIR" value="${FLEX_HOME}/frameworks/locale"/>
    	<property name="BASE_DIR" value="${basedir}" />
	<property name="RESOURCES_DIR" value="${BASE_DIR}/resources" />	
	<property name="PROD_RESOURCES_DIR" value="${RESOURCES_DIR}/prod" />	
	<property name="SRC_DIR" value="${BASE_DIR}/src" />
		
	<property name="OUTPUT_DIR" value="${BASE_DIR}/bin" />
	<taskdef resource="flexTasks.tasks" classpath="${FLEX_HOME}/ant/lib/flexTasks.jar" />

	<property name="AVAILABLE_LOCALES" value="az_AZ,bn_BN,bg_BG,cs_CZ,da_DK,de_DE,el_GR,en_US,es_ES,es_LA,eu_EU,fa_IR,fr_FR,fr_CA,hr_HR,hu_HU,id_ID,it_IT,ja_JP,ko_KR,lv_LV,lt_LT,mn_MN,nb_NO,ne_NE,nl_NL,pl_PL,pt_BR,pt_PT,ro_RO,ru_RU,sv_SE,sr_RS,sr_SR,th_TH,tr_TR,vi_VN,uk_UA,zh_CN,zh_TW"/>
	
	<xmlproperty file="${SRC_DIR}/conf/locales.xml" collapseAttributes="true"/>
	
	<target name="init-ant-contrib">
		<property name="ant-contrib.jar" location="${BASE_DIR}/build/lib/ant-contrib-0.6.jar"/>
		<taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="${ant-contrib.jar}"/>
	</target>

	<target name="localization" depends="init-ant-contrib">
		<echo message="Parsing ${SRC_DIR}/conf/locales.xml for supported locales"/>
		<echo message="Available locales ${AVAILABLE_LOCALES}"/>
		<!--foreach list="${locales.locale.code}" target="build-locale" param="supportedlocale" delimiter=","/-->
		<foreach list="${AVAILABLE_LOCALES}" target="build-locale" param="supportedlocale" delimiter=","/>
	</target>
	
	<target name="build-locale">
		<echo message="Building ${supportedlocale}"/>
		<available file="${LOCALE_DIR}/${supportedlocale}" type="dir" property="locale.dir.present"/>
		<if> 
           		<equals arg1="${locale.dir.present}" arg2="true"/> 
           	<then> 
              		<echo message="No need to copy ${LOCALE_DIR}/${supportedlocale}"/> 
           	</then> 
           	<else> 
              		<echo message="Need to copy ${LOCALE_DIR}/${supportedlocale}"/> 
              		<exec dir="${BASE_DIR}" vmlauncher="true" executable="copylocale">
				<arg value="en_US"/>
    				<arg value="${supportedlocale}"/>
			</exec>
           	</else> 
        	</if>
        	<compileLocale locale="${supportedlocale}" />        
	</target>
		
	<macrodef name="compileLocale" description="Compiles the Resource package for the given locale">
		<attribute name="locale" default="en_US"/>
		<sequential>
			<echo message="Building @{locale}"/>
		<available file="${LOCALE_DIR}/@{locale}" type="dir" property="locale.dir.present"/>
		<if> 
           <equals arg1="${locale.dir.present}" arg2="true"/> 
           <then> 
              <echo message="No need to copy ${LOCALE_DIR}/@{locale}"/> 
           </then> 
           <else> 
              <echo message="Need to copy ${LOCALE_DIR}/@{locale}"/> 
              <exec dir="${BASE_DIR}" vmlauncher="true" executable="copylocale">
				<arg value="en_US"/>
    			<arg value="@{locale}"/>
			</exec>
           </else> 
        </if>
        
			<!--
			Create the Flex Home directory for the language in question.
			This is necessary to compensate for a bug in pre-3.2 releases of 
			mxmlc.
			
			<mkdir dir="${FLEX_HOME}/frameworks/locale/@{locale}"/>-->
			
			<!-- Invoke MXMLC -->
			<mxmlc output="${OUTPUT_DIR}/locale/@{locale}_resources.swf">
				<locale>@{locale}</locale>
				<target-player>10.0.0</target-player>
				<source-path path-element="locale/{locale}"/>
				<include-resource-bundles>bbbResources</include-resource-bundles>
				<include-resource-bundles>core</include-resource-bundles>
				<include-resource-bundles>controls</include-resource-bundles>
				<source-path path-element="${FLEX_HOME}/frameworks"/>
			</mxmlc>
		</sequential>
	</macrodef>
		
	<target name="clean">
		<delete dir="${OUTPUT_DIR}/locale" />
		<mkdir dir="${OUTPUT_DIR}"/>
	</target>

	<target name="cleanandmake" depends="clean,localization" description="Build locales for client."/>

</project>
